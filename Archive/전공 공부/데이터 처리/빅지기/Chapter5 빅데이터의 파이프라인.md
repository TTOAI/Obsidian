
## 5-1 워크플로 관리

- 워크플로 관리 도구의 종류
	- 선언 형
		- XML, YXML 등의 서식으로 워크플로를 기술
		- 미리 제공된 기능만 이용
		- 누가 작성해도 동일한 워크플로 -> 유지보수성 높아짐
		- 동일 쿼리 + 파라미터 튜닝 후 여러 번 실행에 사용
		- 워크플로 단순 반복적 자동 생성에 사용
	- 스크립트 형
		- 스크립트 언어로 워크플로를 정의
		- 유연성
		- 변수나 제어 구문 사용, 태스크 정의 프로그래밍
		- 데이터 처리를 태스크 안에서 실행
		- ex. 파일의 문자 코드를 변환하면서 서버에 업로드
	- ex. ETL 프로세스에는 스크립트 형의 도구, SQL의 실행에는 선언형 도구

- 오류로부터 자동 회복하는 것을 고려하지 않음
- 수작업에 의한 복구를 전제한 태스크 설계
- 실패한 태스크 모두 기록 후 재실행
- 복구의 기초: 동일 플로우 + 동일 파라미터 -> 동일 태스크

- 적당한 수의 재시도로 수작업 없이 복구
- 재시도를 반복해도 문제 없는 태스크에 사용

- 백필: 파라미터에 포함된 일시를 순서대로 바꿔가면서 일정 기간의 플로우를 연속해서 실행하는 구조
- 며칠동안 쌓인 실패한 태스크들을 모아서 재실행
- 새롭게 만든 워크플로를 과거 태스크에 실행
- 과거 며칠간의 데이터를 처리하므로 오류가 대량 발생 가능
- 자동적인 재시도 모두 무효, 오류 모두 통지

- 원자성 조작으로 재시도 시의 안정성 높임
- 아주 작은 가능성도 허가하지 않을 때는 수동 복구

- 멱등한 추가를 위한 테이블 파티셔닝
- 파티션으로 나누어서 파티션을 치환함

- 태스크 내부에서의 재시도 제어
	- 지수 백오프
	- 타임 아웃 (SLA)

- 중간테이블을 치환함으로써 명등성 확보
- 각 플로우가 전체로서 멱등하게 되도록 구현 -> 처음부터 재실행해도 안전

- 태스크 큐에 저장된 태스크들을 일정 수의 워커 프로세스가 병렬 실행

## 5-2 배치 형의 데이터 플로우

- MapReduce와 같은 외부 도구에 의존(워크플로)하지 않고, 다단계의 데이터 처리를 분산 시스탬 내부에서 실행 -> 데이터 플로우

- DAG: 방향성 비순환 그래프
- 데이터 파이프라인 전체를 DAG로 조립 후 실행
- 스케줄러가 분산 시스템에 효과적인 실행 계획을 세울 수 있음

- 데이터 플로우도 워크플로가 관리하는 하나의 태스크로 고려

- 데이터 플로우에서는 성능적으로 안정된 분산 스토리지만 이용

- 데이터 웨어하우스의 파이프라인
- 데이터 마트의 파이프라인
- 대화식 플로우

## 5-3 스트리밍 형의 데이터 플로우

- 실시간 처리를 위해 DAG를 사용한 스트림 처리
- 스트림 처리에서는 메시지 브로커에서 분산 스토리지로 가지 않고 바로 처리됨
- 스트림 처리에서는 데이터가 끊임없이 생산되고 DAG로 흘러들어감

- 스트림 처리와 배치 처리를 동시에 실행
- 배치 처리의 결과가 나올 때까지 스트림 처리의 결과를 잠정 값으로 이용

- 람다 아키텍처
- 스피드 레이어(스트림 처리, 실시간 뷰), 배치 레이어(배치 처리), 서빙 레이어(배치 뷰)

- 카파 아키텍처
- 배치 레이어와 서빙 레이어를 완전히 제거
- 메시지 브로커의 데이터 보관 기간을 충분히 길게 함

- 이벤트 시간 윈도윙
- 아웃 오브 오더 데이터의 순서를 바꿔 집계 결과 업데이트
