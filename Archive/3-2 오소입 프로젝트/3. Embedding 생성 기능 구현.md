# ğŸ¯ **3ë‹¨ê³„ ëª©í‘œ**

âœ” Sentence-Transformers ëª¨ë¸ ì„¤ì¹˜  
âœ” get_embedding() í•¨ìˆ˜ êµ¬í˜„  
âœ” FastAPIì—ì„œ embedding í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€  
âœ” Dockerë¡œ ì •ìƒ ë¹Œë“œ & ì‹¤í–‰ í™•ì¸

---

# â­ Step 3-1 â€” requirements.txt ìˆ˜ì •

ğŸ“ `backend/requirements.txt` ì—ì„œ `openai` ì œê±°, `sentence-transformers` ì¶”ê°€

ìµœì¢… ë‚´ìš© ì˜ˆì‹œ:

```
fastapi
uvicorn
qdrant-client
python-dotenv
sentence-transformers
```

ì´ì œ ë¬´ë£Œ embedding ëª¨ë¸ì„ ì‚¬ìš© ê°€ëŠ¥!

ğŸš¨ requirements.txt ìˆ˜ì •í–ˆìœ¼ë©´ ë‚˜ì¤‘ì— Dockerë¡œ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ í•¨.

---

# â­ Step 3-2 â€” ë¬´ë£Œ embedding ëª¨ë¸ êµ¬í˜„ (embedding.py)

ğŸ“ `backend/app/services/embedding.py` íŒŒì¼ ìƒì„± ë˜ëŠ” ìˆ˜ì •:

```python
from sentence_transformers import SentenceTransformer

# ë¬´ë£Œë¡œ ë§ì´ ì“°ì´ëŠ” ëª¨ë¸ (ê°•ë ¥í•˜ê³  ë¹ ë¦„)
EMBED_MODEL = "all-MiniLM-L6-v2"

model = SentenceTransformer(EMBED_MODEL)

def get_embedding(text: str):
    """
    í…ìŠ¤íŠ¸ë¥¼ embedding vector(list)ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜.
    SentenceTransformer ëª¨ë¸ì„ ì‚¬ìš©í•´ ë¬´ë£Œë¡œ ë²¡í„° ìƒì„±.
    """
    if not text:
        return []
    
    # SentenceTransformerëŠ” ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì…ë ¥ë°›ì•„ ë²¡í„°ë¥¼ ë°˜í™˜í•¨
    vector = model.encode([text])[0]   # ì²« ë²ˆì§¸ ê²°ê³¼ë§Œ ì‚¬ìš©
    return vector.tolist()
```

---

# â­ Step 3-3 â€” Test API (embedding í…ŒìŠ¤íŠ¸ìš©)

embeddingì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ í•˜ë‚˜ ë§Œë“¤ì.

ğŸ“ `backend/app/routers/test_embed.py` ìƒì„±:

```python
from fastapi import APIRouter
from app.services.embedding import get_embedding

router = APIRouter()

@router.get("/test-embed")
def test_embed():
    text = "ë¬´ë£Œ embeddingì´ ì˜ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤."
    vec = get_embedding(text)
    return {
        "vector_length": len(vec),
        "vector_preview": vec[:5]
    }
```

---

# â­ Step 3-4 â€” main.pyì— ë¼ìš°í„° ì¶”ê°€

ğŸ“ `backend/main.py` ìˆ˜ì •:

```python
from fastapi import FastAPI
from app.routers import ingest
from app.routers import test_embed

app = FastAPI()

app.include_router(ingest.router)
app.include_router(test_embed.router)

@app.get("/")
def health():
    return {"status": "ok"}
```

---

# â­ Step 3-5 â€” Docker ì¬ë¹Œë“œ í›„ ì‹¤í–‰

```bash
docker compose down
docker compose up --build -d
```

---

# â­ Step 3-6 â€” Embedding ì •ìƒ ì‘ë™ í™•ì¸!

ë¸Œë¼ìš°ì € ë˜ëŠ” Postmanì—ì„œ:

ğŸ‘‰ [http://localhost:8000/test-embed](http://localhost:8000/test-embed)

ì˜ˆìƒ ì •ìƒ ì‘ë‹µ:

```json
{
  "vector_length": 384,
  "vector_preview": [-0.0215, 0.0342, 0.1123, ...]
}
```

### ğŸ“Œ ì¤‘ìš” í¬ì¸íŠ¸

- ë¬´ë£Œ ëª¨ë¸ **all-MiniLM-L6-v2**ì˜ ë²¡í„° ì°¨ì›ì€ **384**
- ìˆ«ì ë°°ì—´ì´ ë‚˜ì˜¤ë©´ embedding ì •ìƒ ì‘ë™!

---

# ğŸ‰ 3ë‹¨ê³„ ì™„ë£Œ ê¸°ì¤€ ì²´í¬

|í™•ì¸ í•­ëª©|ì„±ê³µ ì—¬ë¶€|
|---|---|
|SentenceTransformers ì„¤ì¹˜ë¨|âœ”|
|get_embedding() ì •ìƒ ë™ì‘|âœ”|
|/test-embed í˜¸ì¶œ ì„±ê³µ|âœ”|
|ë²¡í„° ê¸¸ì´(384) ì •ìƒ|âœ”|
|Dockerì—ì„œ ì˜¤ë¥˜ ì—†ì´ ëŒì•„ê°|âœ”|

ì™„ë²½í•˜ê²Œ ë™ì‘í•˜ë©´ ì´ì œ embeddingì„ chunkì— ë¶™ì—¬ Qdrantì— ì €ì¥í•  ì¤€ë¹„ê°€ ëë‚œ ê±°ì•¼.

---

# ğŸ”œ ë‹¤ìŒ ë‹¨ê³„ (4ë‹¨ê³„): Qdrant ì €ì¥ êµ¬í˜„

ì´ì œ ë¬¸ì„œ chunk + embeddingì„ ë¬¶ì–´ì„œ  
**ë²¡í„°DBì¸ Qdrantì— ì‹¤ì œë¡œ ì €ì¥í•˜ëŠ” ë‹¨ê³„**ë¥¼ ì§„í–‰í•˜ê²Œ ë¼.

ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ”:

âœ” Qdrant ì»¬ë ‰ì…˜ ìƒì„±  
âœ” points ì €ì¥(upsert)  
âœ” ê²€ìƒ‰(search)  
âœ” ë¬¸ì„œ ì €ì¥/ì¡°íšŒ í…ŒìŠ¤íŠ¸

ì´ ì™„ì„±ë˜ë©´ ë¬¸ì„œ ì¸ë±ì‹± ì—”ì§„ì´ ì™„ì„±ë¨.

---

ë°”ë¡œ **4ë‹¨ê³„ ì§„í–‰í•´ì¤„ê¹Œ?**
