## Scrapy + Playwright 환경 설정 및 선택자 이해

1. Scrapy 설치

* `pip install scrapy`

2. Playwright 및 scrapy-playwright 설치

* `pip install playwright scrapy-playwright`

* Playwright 브라우저 드라이버 설치:

```bash

playwright install

```

* Scrapy 설정에서 `scrapy-playwright` 활성화:

```python

# settings.py

DOWNLOADER_MIDDLEWARES = {

"scrapy_playwright.middleware.ScrapyPlaywrightDownloaderMiddleware": 543,

}

```

3. CSS 선택자 / XPath 개념

* Scrapy는 기본적으로 **CSS 선택자**(`response.css()`)와 **XPath**(`response.xpath()`)를 모두 지원

* CSS 선택자 예시:

* `response.css("h1::text").get()`

* `response.css("div.content a::attr(href)").getall()`

* XPath 예시:

* `response.xpath("//h1/text()").get()`

* `response.xpath("//div[@class='content']//a/@href").getall()`

4. XPath / CSS 확인 방법

* 브라우저 개발자 도구에서 요소 선택 → 우클릭 → Copy → Copy XPath / Copy Selector

---

## Scrapy + Playwright으로 웹 페이지 크롤링하기

1. 프로젝트 생성 및 실행

* 프로젝트 생성: `scrapy startproject myproject`

* 크롤러 생성: `scrapy genspider example example.com`

* 실행: `scrapy crawl example -O output.json`

2. Playwright 요청 사용

* 일반 요청:

```python

yield scrapy.Request(url, callback=self.parse)

```

* Playwright 기반 요청:

```python

yield scrapy.Request(

url,

meta={"playwright": True},

callback=self.parse_page

)

```

3. 실행 지연 및 대기

* Playwright에서 JS 실행을 기다리도록 설정 가능:

```python

yield scrapy.Request(

url,

meta={

"playwright": True,

"playwright_page_methods": [

PageMethod("wait_for_selector", "div.article")

],

},

callback=self.parse

)

```

* `wait_for_selector`: 특정 요소가 렌더링될 때까지 대기

4. 요소 찾기

* Scrapy 기본 방식:

* `response.css("h1::text").get()`

* `response.xpath("//h1/text()").get()`

* Playwright 조합 방식: JS 실행 후 완성된 DOM 구조에서 위와 같이 탐색

5. 페이지 조작 (버튼 클릭, 스크롤)

* `playwright_page_methods`를 이용해 동작 정의:

```python

meta={

"playwright": True,

"playwright_page_methods": [

PageMethod("click", "button.load-more"),

PageMethod("wait_for_selector", "div.new-article"),

],

}

```

* 스크롤:

```python

PageMethod("evaluate", "window.scrollBy(0, document.body.scrollHeight)")

```

6. 탭/새 창 처리

* 기본적으로 Scrapy는 새로운 탭을 열지 않고, 지정된 URL을 요청 단위로 처리

* Playwright 필요 시 `new_page()` 호출 가능하지만 일반 크롤링에서는 잘 쓰지 않음

7. 스크린샷

* Playwright는 스크린샷 지원:

```python

PageMethod("screenshot", path="page.png", full_page=True)

```

8. 헤드리스 모드

* 기본적으로 Playwright는 **헤드리스 모드**로 실행됨

* 시각적 디버깅 필요 시:

```bash

playwright codegen https://example.com

```

* 브라우저 창이 뜨는 환경에서 동작 확인 가능
