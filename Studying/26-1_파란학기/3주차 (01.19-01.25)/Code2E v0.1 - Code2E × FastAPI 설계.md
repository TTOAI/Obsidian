
## 실험의 목적

> AI가 백엔드 개발 사이클을 자율적으로 수행할 때  
> 어디까지가 신뢰 가능하고,  
> 어디서부터 인간 개입이 필수적으로 요구되는지를  
> End-to-End 실행과 기록을 통해 밝히는 것이다.
---

## 실험의 최상위 목표

> 최소한의 백엔드 프레임워크 환경에서  
> AI가 요구사항 기반 개발 사이클을  
> 자율적으로 반복 수행하며  
> 그 성공·실패·수렴 과정을  
> 코드, 실행 로그, 테스트 결과, 커밋 이력으로  
> 명확히 기록할 수 있는지를 검증하는 것이다.

- 수렴: 반복 수정 과정에서 실패 유형이 감소하거나 변화가 없으며, 추가 수정이 의미 있는 개선을 만들지 못한다고 판단되는 상태
---

## 실패의 정의

- F1. 원인 없는 무한 반복
	- 동일한 오류를 해결하지 못한 채 이유 설명 없이 반복
    - → Code2E 구조 문제
- F2. 실패는 발생했지만 해석되지 않음
	- 로그는 있음
	- 테스트 결과는 있음
	- 그러나 “왜 이 지점에서 멈췄는지” 설명 불가
	- → 평가 레이어 부족
- F3. 결과물은 코드뿐이고 과정이 없음
	- 최종 코드만 존재
	- 실패/수정/결정 기록 없음
	- → Code2E 정체성 붕괴
- Human-in-the-loop 개입의 정의
	- 허용되는 인간 개입
		- 최초 요구사항/명세 입력
		- 실험 종료 후 결과 해석
		- “이 커밋부터 내가 작업” 결정
	- 허용되지 않는 인간 개입
		- 코드 직접 수정
		- 테스트 직접 추가
		- 실행 실패 수동 해결
---

## FastAPI 실험의 Scope 명시

- 포함
	- 단일 FastAPI 앱
	- 단일 또는 소수 API
	- 로컬 실행
	- pytest 기반 테스트
- 제외
	- 인증/인가
	- 외부 API
	- 분산 시스템
	- 성능 최적화
---

## 실험 대상 문제 (Problem Definition)

-  대상 시스템
	- 단일 FastAPI 애플리케이션
	- 계산/간단한 CRUD/검증 로직 등
	- 실행·테스트·에러가 반드시 발생할 수 있는 문제

- 입력으로 주어지는 것 (Human Input)
	- 프로젝트 개요 (자연어)
	- 기능 요구사항 (FR)
	- 비기능 요구사항 (NFR)
	- 테스트 요구사항 (명세 수준)
	- 성공/실패 정의
---

## v0.1에서의 시스템 구성

- Master Agent
	- 전체 실험 흐름 제어
	- Step 상태 관리
	- Agent 호출 순서 제어
	- Execution 결과 수집
	- Decision Layer 호출
	- Git 커밋 트리거
	- 로그/메타데이터 집계

- Code Agent
	- 입력:
		- 요구사항
		- Test Agent의 실패 요약 (구조화된 텍스트)
	- 출력:
		- FastAPI 코드 생성/수정
	- 제약:
		- 테스트 코드 X
		- 전체 실패 로그 X
		- 실행 환경 정보 X

- Execution Layer
	- FastAPI 서버 실행
	- pytest 실행
	- 예외/에러/trace 수집
	- 실행 결과를 그대로 반환

- Test Agent
	- 입력:
		- 요구사항
		- Execution Layer 결과
	- 출력:
		- 테스트 코드 (pytest)
		- 실패 유형 분류
		- “어디가 깨졌는지” 요약
		- 다음 수정 방향 제안
			- 구현 방법이 아닌, 실패 유형 수준의 제약 조건 또는 검증 관점 제안
	- 제약:
		- 코드 내부 구조 X
		- Code Agent 구현 의도 X

- Decision Layer (정책/판단)
	- 규칙 기반으로만 동작
	- 입력:
		- 반복 횟수
		- 실패 유형 변화
		- 테스트 통과율 변화
		- 수정 diff 크기
		- 실행 성공 여부
	- 출력:
		- CONTINUE (자동 수정)
		- STOP (자동화 중단)
		- ESCALATE (Human-in-the-loop 필요)

-  Final Agent
	- 최종 코드 상태 정리
	- 중간 코드 스냅샷
	- Git 커밋 히스토리 요약
	- 실행/테스트 로그 요약
	- 요구사항 충족 매핑
	- 최종 실험 보고서 생성
---

## 개발 루프 상세 흐름

```
[Human Input]
   ↓
[Master]
   ↓
[Code Agent] → 코드 생성
   ↓
[Execution Layer] → 실행/테스트
   ↓
[Test Agent] → 실패 해석
   ↓
[Decision Layer]
   ├─ CONTINUE → Master → Code Agent
   ├─ STOP → Final Agent
   └─ ESCALATE → Final Agent
```
- 이 루프가 최소 1회 이상 닫히면 S1 충족
---

## Git 커밋 설계 (v0.1 기준)

- 커밋 전략
	- 코드 변경이 발생한 경우만 커밋
	- 커밋은 **Master가 수행**
	- 커밋 메시지에 반드시 포함:
		- iteration 번호
		- 변경 목적
		- Decision Layer 판단 근거 요약

- 예:
```
iter-2: fix division by zero
reason: test_division_by_zero failure
decision: continue automation
```
---

## v0.1에서 수집해야 할 핵심 데이터

- 구조화 로그
	- iteration 번호
	- 실패 유형
	- 수정 범위
	- 테스트 통과율
	- Decision 결과

- 실험 결과 데이터
	- 반복 횟수
	- 수렴/중단 지점
	- 자동화 성공 구간
	- 인간 개입 필요 구간
---

## 성공 정의

- S1. End-to-End 개발 루프가 닫혔다.
	- Code2E가 다음 단계를 사람 개입 없이 수행할 수 있어야 함
		1. 요구사항 입력
		2. FastAPI 코드 생성
		3. 서버 실행 시도
		4. 테스트 실행
		5. 실패 감지
		6. 수정 시도
		7. 중단 또는 수렴 결정
	-  서버가 완벽히 뜨지 않아도 되지만, 왜 멈췄는지를 Code2E가 판단해야 함

- S2. 실패가 구조적으로 기록되었다
	- 다음 중 최소 1개 이상이 명확히 기록되어야 함
		- 실행 실패 원인
		- 테스트 실패 유형
		- 반복 수정 패턴
		- 수렴 실패 지점
	- 단순 로그가 아닌 "이 단계에서 자동화를 멈춰야 하는 이유"로 설명 가능해야 함

- S3. 요구사항 충족 여부가 명시적으로 매핑되었다
	- Code2E는 결과 보고서에서 다음을 제공해야 함

| 요구사항      | 충족 여부 | 근거     |
| --------- | ----- | ------ |
| API 정상 응답 | O / X | 테스트 결과 |
| 입력 검증     | O / X | 코드/로그  |
| 에러 처리     | O / X | 실행 로그  |

-  S4. 개발 과정이 Git 커밋과 연결되었다
	- 다음이 충족되어야 함
		- Code2E가 코드 변경 단위로 커밋 수행
		- 각 커밋이 어떤 목적(수정/실험/실패 대응)을 가졌는지 설명
		- 최종 보고서에서 다음을 명시
		    - “이 커밋까지는 자동화 가능”
		    - “이 커밋 이후는 인간 개입 필요”
---

## v0.1의 성공/실패 판정 정리

- v0.1 성공 조건
	- S1~S4 중 모두 충족
	- 일부 요구사항 실패 OK
	- 테스트 실패 OK
	- 자동화 중단 OK
- 결과에 대해 설명 가능하면 성공

- v0.1 실패 조건
	- 무한 루프 + 이유 설명 불가
	- 실행 결과 있음에도 Decision 판단 불가
	- 코드만 남고 로그/보고서 없음
---

## v0.1 산출물

1. FastAPI 코드 (중간/최종)
2. pytest 테스트 코드
3. Git 커밋 히스토리
4. 실행 로그
5. 실패 유형 요약
6. 요구사항 충족 매핑 표
7. 최종 실험 보고서
---

## v0.1 결론

- AI 개발 자동화의 실제 경계
- 환각·편향·무한 루프가 발생하는 지
- Human-in-the-loop이 필요한 정확한 시점
- Code2E 프레임워크의 최소 실체
---

## Final Agent가 작성할 보고서의 구조

```
1. 실험 개요
    - 실험 목적
    - 입력 요구사항 요약
2. 개발 루프 요약
    - iteration별 상태
    - 각 iteration의 커밋 해시
3. 자동화 가능 구간
    - 자동화 가능 마지막 커밋: `commit_hash_X`
    - 해당 시점까지의 요구사항 충족 상태
4. 자동화 중단 지점
    - 중단 결정 커밋: `commit_hash_Y`
    - 중단 사유 (Decision Layer 판단 근거)
5. 실패 및 반복 패턴 분석
    - 반복된 실패 유형
    - 수정 패턴 요약
6. Human-in-the-loop 제안
    - 인간 개입이 필요한 이유
    - 이후 사람이 작업해야 할 방향
```
---

## MCP 구현

