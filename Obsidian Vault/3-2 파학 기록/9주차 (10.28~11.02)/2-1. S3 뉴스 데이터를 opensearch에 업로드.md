
### Lambda 함수 설정

- Lambda에서 VPC 설정을 하기 위해 Lambda 함수에 EC2 role 부여
- OpenSearch와 같은 VPC의 Private Subnet 2개 이상에 속해야 함
	- OpenSearch, Lambda 모두 동일하게 Subnet 2개로 설정
	- OpenSearch -> 기존 가용영역 1에서 2로 늘림
- 보안그룹:
	- Outbound 443 허용
	- OpenSearch SG Inbound에 이 Lambda SG를 소스로 허용

---

### OpenSearch FGAC Role Mapping

- OpenSearch 도메인에서 Fine-Grained Access Control (FGAC) 이 활성화되어 있는 경우
- Lambda 함수가 OpenSearch 인덱스에 접근(읽기/쓰기)하려면
- 해당 Lambda의 IAM Role을 OpenSearch 내부의 Role(all_access)에 매핑해야 함

- AWS CloudShell에서 OpenSearch와 같은 VPC 및 서브넷 내의 VPC env 생성
- 다음 실행
```
curl -X PUT "https://vpc-imfact-opensearch-ds7i7z54jyxh2ohb6k5c7t45fy.ap-northeast-2.es.amazonaws.com/_plugins/_security/api/rolesmapping/all_access" \
-H "Content-Type: application/json" \
-d '{
  "backend_roles": [
    "arn:aws:iam::567097740956:role/service-role/imfact-indexer-lambda-role-rlw0adq4"
  ]
}' \
-u 'imfact-admin:Factim!123'
```

- Role Mapping이 정상적으로 등록되면 아래와 같은 응답 표시
```
{"status":"OK","message":"'all_access' updated."}
```

---

### S3 버킷에 Event notifications 생성

- S3 버킷에서 특정 이벤트 발생시 특정 대상(ex. Lambda 함수)에 이벤트 게시

---

### OpenSearch 애플리케이션 생성


