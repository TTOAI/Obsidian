
```
┌────────────────────────────┐
│ AWS S3 (입력 버킷)          │
│  - input/news_batch.jsonl  │
└────────────┬───────────────┘
             │
             ▼
[ECS Fargate / Lambda]
 ┌───────────────────────────────┐
 │ ImFact Inference Container    │
 │  - FastAPI or Batch Runner    │
 │  - title_model, body_model    │
 │  - compute_news_reliability() │
 └───────────────────────────────┘
             │
             ▼
┌──────────────────────────────┐
│ AWS S3 (출력 버킷)            │
│  - output/news_scored.jsonl  │
└──────────────────────────────┘
```

- aws 설치
```
# 1️⃣ AWS CLI zip 파일 다운로드
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"

sudo apt install unzip

# 2️⃣ 압축 해제
unzip awscliv2.zip

# 3️⃣ 설치
sudo ./aws/install

# 4️⃣ 버전 확인
aws --version

aws configure

aws sts get-caller-identity
```


### Docker Desktop WSL 2 통합

- Docker Desktop을 실행
- Settings (설정) > Resources (리소스) > WSL INTEGRATION (WSL 통합)
- WSL 2 배포판 (예: Ubuntu, Debian 등)에 대한 통합 활성화(Enabled)

```
# 로그인
aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 567097740956.dkr.ecr.ap-northeast-2.amazonaws.com

# 빌드
docker build -t imfact-inferer:latest .

# 태그 (ECR 리포지토리 이름: imfact-inferer)
docker tag imfact-inferer:dev 567097740956.dkr.ecr.ap-northeast-2.amazonaws.com/imfact-inferer:dev

# 푸시
docker push 567097740956.dkr.ecr.ap-northeast-2.amazonaws.com/imfact-inferer:dev

# 확인
aws ecr describe-images --repository-name imfact-inferer --region ap-northeast-2 \
  --query 'imageDetails[].imageTags'
```

### ECS GPU 클러스터 생성 (EC2 Launch Type)

![[Pasted image 20251113082333.png]]

![[Pasted image 20251113082350.png]]

![[Pasted image 20251113082407.png]]

![[Pasted image 20251113082419.png]]


### EC2 시작 템플릿 (Launch Template) 생성
- ECS 클러스터 생성 시에 EC2 시작 템플릿과 Auto Scaling Group 같이 생성 가능

![[Pasted image 20251113100504.png]]

![[Pasted image 20251113090953.png]]

![[Pasted image 20251113100530.png]]

![[Pasted image 20251113100548.png]]

![[Pasted image 20251113100602.png]]

![[Pasted image 20251113100622.png]]

![[Pasted image 20251113100638.png]]

![[Pasted image 20251113104807.png]]

![[Pasted image 20251113104818.png]]

![[Pasted image 20251113104911.png]]

![[Pasted image 20251113105059.png]]


### 태스크 정의

![[Pasted image 20251113142531.png]]

![[Pasted image 20251113142546.png]]

![[Pasted image 20251113142604.png]]

![[Pasted image 20251113142939.png]]


### 클러스터에서 태스크 실행

![[Pasted image 20251113143305.png]]

- CPU를 사용해도 10분 내외로 충분히 추론 가능하므로 Fargate를 쓰기로 결정
