
보안 관련 키워드: CORS 정책, CSRF, XSS
## 세션 방식
#### 세부 프로세스 및 구현 방식
- 보통 세션ID를 쿠키에 저장하고 전달하는 쿠키 방식을 함께 사용함
#### 특징
- 
#### 장점
- 
#### 단점
- 세션ID 즉시 무효화 가능
#### 쿠키 사용에 따른 보안 위협 측면
- XSS 공격 -> HTTP-Only, Secure, SameSite 설정
#### 보안을 위한 방안
- HTTPS 구축

---
## 토큰 방식
#### 세부 프로세스 및 구현 방식
- access token은 보통 HTTP 헤더로 전달 후 브라우저의 LocalStorage에 저장
	- 전달할 때는 "Authorization: Bearer token" 형식으로 전달
- refresh token은 보통 쿠키로 전달 후 CookieStorage에 저장
- access token 재발급에서 refresh token도 같이 재발급 -> RTR
- refresh token 발급 방식
	- JWT: access token을 발급할 필요한 정보를 claim에 저장 가능
	- UUID: 발급과 삭제가 쉬움
#### 특징
- 클레임: 
- 클라이언트 측에서도 토큰을 파싱하여 사용할 수 있음
	- 토큰의 클레임 정보(역할, 권한, 만료 시간 등)를 확인하여 사용자 별로 맞춤 UI 제공 가능
	- 하지만 보안상의 이유로 최종 검증은 서버에서 이루어져야 함
#### 장점
- 쿠키 활용이 어려운 앱개발 환경에서 유리함
#### 단점
- 토큰 즉시 무효화 불가능

#### HTTP 헤더 사용에 따른 보안 위협 측면
- 

#### 보안을 위한 방안
 - XSS에 대비하기 위해서 Access 토큰의 생명 주기를 짧게 하고 Refresh 도입
 - XSS 방어를 위해 Refresh token은 쿠키에 저장
 - Refresh 토큰을 저장하는 쿠키에는 `httpOnly`와 `Secure` 옵션을 설정하여 클라이언트 측 스크립트로부터 접근을 차단
 - Refresh token의 경우 특정 상황에만 사용하므로 CSRF에 대한 큰 보안 위협 가능성이 적음
- 에디터단에서 JS 임베드 방어

---
## 폼 로그인 방식

---
## HTTP Basic 방식

---
## OAuth2 로그인 방식
- 전통적인 API 호출 방식(axios, fetch) 대신 브라우저의 리다이렉션(location.href 등)을 사용하는 구조로 설계
	- API 클라이언트를 사용하면 CORS 정책에 의해 외부 도메인에 요청을 보내는 데 제약이 발생할 수 있음
	- 브라우저 전체를 리다이렉트하여 외부 도메인과의 상호작용을 가능하게 함
	- OAuth2 로그인 과정에서는 사용자가 인증 정보 입력 및 동의 절차를 거치게 되는데, 이는 전용 로그인 페이지를 통해 이루어므로 사용자가 직접 해당 페이지로 이동해야 함

---
## 토큰 방식 + OAuth2 로그인 방식에서의 문제점
- 참고1
![[Pasted image 20250223010609.png]]
- 참고2
![[Pasted image 20250223010635.png]]
![[Pasted image 20250223024730.png]]
https://www.youtube.com/watch?v=s6D_zXnrXNo&list=PLJkjrxxiBSFALedMwcqDw_BPaJ3qqbWeB&index=13
- OAuth2 로그인의 경우 동작 특성상 href로 요청하기 때문에 무조건 쿠키로 응답해야 함
- 로그인 성공 후 백엔드에서 프론트엔드로 토큰을 넘겨줄 때 HTTP 헤더 방식을 사용하려고 하면 302 상태 코드 때문에 프론트엔드에서 "Location" 외의 HTTP 헤더를 읽지 못하는 문제가 발생함
- 리다이렉트 응답에서도 쿠키 설정은 정상적으로 동작
	- 백엔드가 리다이렉트(예, 302 응답)를 보낼 때 응답 헤더에 "Set-Cookie"가 포함되어 있으면, 브라우저는 자동으로 해당 쿠키를 쿠키 스토리지에 저장한 후 리다이렉트 처리를 진행
## 문제 해결 방법
- refresh token만 먼저 발급
	1. SuccessHandler에서 refresh token만 쿠키 방식으로 발급
	2. sendRedirectUrl 설정으로 프론트엔드의 특정한 페이지로 리다이렉션
	3. 프론트엔드의 특정한 페이지는 요청이 온다면 무조건 useEffect와 같은 함수로 백엔드의 특정 경로로 axios나 fetch로 요청. 이 때 쿠키에 담겨 있는 refresh token도 자동으로 따라갈 수 있도록 credentials 값은 true로 설정
	4. 백엔드는 요청에 대해 refresh token을 검증하고 access, refresh token 재발급
	- access token, refresh token 전달 및 저장 방식
		- access는 HTTP 헤더를 통해 전달, refresh는 쿠키로 전달 (권장)
		- access, refresh 모두 HTTP 헤더를 통해 전달
		- access, refresh 모두 쿠키로 전달
